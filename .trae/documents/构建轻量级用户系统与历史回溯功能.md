# 方案设计 v2：混合模式（游客/注册用户）

您提出的“游客 + 注册”双模式非常棒！这既降低了用户的准入门槛（想试就试），又提供了注册的动力（保存数据）。这是一个非常经典的增长黑客（Growth Hacker）设计。

## 1. 核心交互流程设计
我们将应用的入口设计为一个简洁的 **Landing Page**，提供两个醒目的按钮：

### A. 🚀 游客试用 (Guest Mode)
- **特点**：无需输入任何信息，直接进入聊天。
- **数据处理**：
    - 后台依然会创建 `Session` 和存储 `Message`。
    - 但 `user_id` 字段为空（或标记为匿名）。
    - **痛点提示**：在对话结束生成报告时，或者用户试图离开时，我们可以弹出一个温和的提示：“您当前是游客身份，关闭页面后记录将丢失。是否想注册账号将其永久保存？”（这是一个转化的高光时刻！）

### B. 🔐 注册/登录 (Member Mode)
- **特点**：输入账号密码后进入。
- **数据处理**：
    - `user_id` 字段关联到当前用户。
    - 进入后先看到 **仪表盘 (Dashboard)**，展示历史记录列表。

## 2. 技术实现细节

### 数据库层 (SQL)
- 修改 `sessions` 表的 `user_id` 字段为 **可空 (Nullable)**。
    - 如果是注册用户，填入 UUID。
    - 如果是游客，填入 NULL。

### 后端层 (DB Client)
- `create_session(user_id=None)`: 支持不传 `user_id` 创建会话。
- `get_user_sessions(user_id)`: 只拉取非空且匹配该 ID 的会话。

### 前端层 (Streamlit)
我们将利用 `st.session_state` 来管理三种视图状态：
1.  **`LANDING`**: 首页，选 A 或 B。
2.  **`AUTH`**: 登录/注册表单页。
3.  **`DASHBOARD`**: 登录后的历史列表页（仅注册用户可见）。
4.  **`CHAT`**: 核心对话页（游客直接进这里，注册用户从 Dashboard 进这里）。

## 3. 执行计划 (Updated)
1.  **SQL 升级**：生成新的 SQL 脚本，允许 `user_id` 为空。
2.  **代码重构**：
    - 修改 `db_client.py` 适配双模式。
    - 重写 `main.py` 的页面路由逻辑。
3.  **文档更新**：更新操作指南，特别是关于如何在 Supabase 关闭邮箱验证的部分。
